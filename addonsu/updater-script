ui_print("Installing su addon...");
package_extract_file("mount-system", "/tmp/mount-system");
set_metadata("/tmp/mount-system", "uid", 0, "gid", 0, "mode", 0755);
assert(run_program("/tmp/mount-system") || abort("Could not mount /system"));
package_extract_dir("system", "/system");
set_metadata("/system/addon.d/51-addonsu.sh", "uid", 0, "gid", 0, "mode", 0755, "selabel", "u:object_r:system_file:s0");
set_metadata("/system/xbin/su", "uid", 0, "gid", 2000, "mode", 0755, "selabel", "u:object_r:su_exec:s0");
unmount("/system");
ui_print("Done");
